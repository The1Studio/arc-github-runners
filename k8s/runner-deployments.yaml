---
# Organization-level runners for the1studio (general-purpose CI/CD)
# Purpose: Default runners for all the1studio repos
# Auto-scaling: 3-10 replicas based on load
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: the1studio-org-runners
  namespace: arc-runners
spec:
  template:
    metadata:
      labels:
        app: actions-runner
        pool: the1studio-org
    spec:
      organization: The1Studio
      image: the1studio/actions-runner:https-apt
      imagePullPolicy: IfNotPresent
      labels:
        - self-hosted
        - linux
        - x64
        - arc
        - the1studio
        - org
      env: []
      # Resource limits prevent DoS attacks and resource exhaustion
      resources:
        limits:
          cpu: "2"
          memory: "4Gi"
        requests:
          cpu: "500m"
          memory: "1Gi"
      # Security context - pod level
      securityContext:
        runAsNonRoot: false  # Must be false due to Docker socket access requirement
        fsGroup: 121  # docker group on host
      # Volume mounts for Docker socket access
      volumeMounts:
        - name: docker-sock
          mountPath: /var/run/docker.sock
      volumes:
        - name: docker-sock
          hostPath:
            path: /var/run/docker.sock
            type: Socket
      # Docker-in-Docker container resources
      dockerdContainerResources:
        limits:
          cpu: "1"
          memory: "2Gi"
        requests:
          cpu: "250m"
          memory: "512Mi"
---
# Personal repository runners for tuha263
# Purpose: Build and deploy personal website (tuha263/personal-site)
# Auto-scaling: 1-5 replicas based on load
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: tuha263-personal-runners
  namespace: arc-runners
spec:
  template:
    metadata:
      labels:
        app: actions-runner
        pool: tuha263-personal
    spec:
      repository: tuha263/personal-site
      image: the1studio/actions-runner:https-apt
      imagePullPolicy: IfNotPresent
      labels:
        - self-hosted
        - linux
        - x64
        - arc
        - personal
      env: []
      # Resource limits prevent DoS attacks and resource exhaustion
      resources:
        limits:
          cpu: "1"
          memory: "2Gi"
        requests:
          cpu: "250m"
          memory: "512Mi"
      # Security context - pod level
      securityContext:
        runAsNonRoot: false  # Must be false due to Docker socket access requirement
        fsGroup: 121  # docker group on host
      # Volume mounts for Docker socket access
      volumeMounts:
        - name: docker-sock
          mountPath: /var/run/docker.sock
      volumes:
        - name: docker-sock
          hostPath:
            path: /var/run/docker.sock
            type: Socket
      # Docker-in-Docker container resources
      dockerdContainerResources:
        limits:
          cpu: "500m"
          memory: "1Gi"
        requests:
          cpu: "100m"
          memory: "256Mi"
---
# Organization-level runners for Android APK builds
# Purpose: Build Android APK files for the1studio organization
# Auto-scaling: 1-3 replicas based on load (conservative due to high resource usage)
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: android-apk-builder
  namespace: arc-runners
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: actions-runner
        pool: android-apk-builder
    spec:
      organization: The1Studio
      image: the1studio/actions-runner:https-apt
      imagePullPolicy: IfNotPresent
      labels:
        - self-hosted
        - linux
        - x64
        - arc
        - android
        - apk-builder
      env: []
      # High resource limits for Android builds
      resources:
        limits:
          cpu: "8"
          memory: "16Gi"
        requests:
          cpu: "4"
          memory: "8Gi"
      # Security context - pod level
      securityContext:
        runAsNonRoot: false  # Must be false due to Docker socket access requirement
        fsGroup: 121  # docker group on host
      # Volume mounts for Docker socket access
      volumeMounts:
        - name: docker-sock
          mountPath: /var/run/docker.sock
      volumes:
        - name: docker-sock
          hostPath:
            path: /var/run/docker.sock
            type: Socket
      # Docker-in-Docker container resources
      dockerdContainerResources:
        limits:
          cpu: "4"
          memory: "8Gi"
        requests:
          cpu: "1"
          memory: "2Gi"
---
# Organization-level runners for Unity deployment
# Purpose: Deploy Unity builds to app stores/hosting for The1Studio
# Auto-scaling: 1-5 replicas based on load
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: containerized-unity-deploy
  namespace: arc-runners
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: actions-runner
        pool: containerized-unity-deploy
    spec:
      organization: The1Studio
      image: the1studio/actions-runner:https-apt
      imagePullPolicy: IfNotPresent
      labels:
        - self-hosted
        - linux
        - x64
        - deploy
      env: []
      # Resource limits for Unity deployment
      resources:
        limits:
          cpu: "4"
          memory: "8Gi"
        requests:
          cpu: "1"
          memory: "2Gi"
      # Security context - pod level
      securityContext:
        runAsNonRoot: false  # Must be false due to Docker socket access requirement
        fsGroup: 121  # docker group on host
      # Volume mounts for Docker socket access
      volumeMounts:
        - name: docker-sock
          mountPath: /var/run/docker.sock
      volumes:
        - name: docker-sock
          hostPath:
            path: /var/run/docker.sock
            type: Socket
      # Docker-in-Docker container resources
      dockerdContainerResources:
        limits:
          cpu: "2"
          memory: "4Gi"
        requests:
          cpu: "500m"
          memory: "1Gi"
---
# Repository-level runners for The1Studio/containerized-unity
# Purpose: Build Unity Editor Docker images and sync to Harbor registry
# Auto-scaling: 1-2 replicas based on load (very conservative due to extreme resource usage)
# Runs on THIS machine with Harbor access for Unity Editor image builds
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: containerized-unity-sync
  namespace: arc-runners
spec:
  template:
    metadata:
      labels:
        app: actions-runner
        pool: containerized-unity
    spec:
      repository: The1Studio/containerized-unity
      image: the1studio/actions-runner:https-apt
      imagePullPolicy: IfNotPresent
      labels:
        - self-hosted
        - linux
        - x64
        - deploy
        - harbor-access
        - harbor-host
      env: []
      # High resource limits for Unity Editor builds
      resources:
        limits:
          cpu: "8"
          memory: "24Gi"
        requests:
          cpu: "2"
          memory: "8Gi"
      # Security context - pod level
      securityContext:
        runAsNonRoot: false  # Must be false due to Docker socket access requirement
        fsGroup: 121  # docker group on host
      # Volume mounts for Docker socket access
      volumeMounts:
        - name: docker-sock
          mountPath: /var/run/docker.sock
      volumes:
        - name: docker-sock
          hostPath:
            path: /var/run/docker.sock
            type: Socket
      # Docker-in-Docker container resources
      dockerdContainerResources:
        limits:
          cpu: "4"
          memory: "8Gi"
        requests:
          cpu: "1"
          memory: "2Gi"
